# CVE-2023-20048 in Cisco Firepower Management Center.

## Summary
A vulnerability in the web services interface of Cisco Firepower Management Center (FMC) Software could allow an authenticated, remote attacker to execute certain unauthorized configuration commands on a Firepower Threat Defense (FTD) device that is managed by the FMC Software.
This vulnerability is due to insufficient authorization of configuration commands that are sent through the web service interface. An attacker could exploit this vulnerability by authenticating to the FMC web services interface and sending a crafted HTTP request to an affected device. A successful exploit could allow the attacker to execute certain configuration commands on the targeted FTD device. To successfully exploit this vulnerability, an attacker would need valid credentials on the FMC Software.

## About the function 
The previous program is a Python function that detects and exploits the CVE-2023-20048 vulnerability in Cisco Firepower Management Center. This vulnerability allows an authenticated attacker to execute unauthorized configuration commands on a Firepower Threat Defense (FTD) device that is managed by FMC. The program does the following steps:
#### It imports the requests and json modules to send HTTP requests and parse responses.
#### It sets the variables for the URL, username, and password for the FMC web services interface.
#### It creates a requests session to handle cookies and certificate verification.
#### It sends a POST request to the /api/fmc_platform/v1/auth/generatetoken endpoint to get the access token and refresh token. It sets the access token as the authorization header for the subsequent requests.

It sets the variable for the domain id. It changes this to the userâ€™s domain id.
It sends a GET request to the 
```
/api/fmc_config/v1/domain/{DOMAIN_UUID}/devices/devicerecords
```
endpoint to get the list of devices managed by FMC. It parses the data to get the list of device names and URLs.
It loops through the list of devices and sends a GET request to the URL of each device to get the device details. It parses the data to get the device type, software version, and configuration URL.
It checks if the device type is FTD and the software version is vulnerable to the CVE-2023-20048 vulnerability. It uses the values from the affected products section in the security advisory.
If the device is vulnerable, it creates a list of commands that it wants to execute on the device. It loops through the list of commands and sends a POST request to the 
```
/api/fmc_config/v1/domain/{DOMAIN_UUID}/devices/devicerecords/{DEVICE_ID}/operational/command/{COMMAND}
```
endpoint to execute each command on the device. It parses the data to get the result of the command execution and prints it.
If the device is not vulnerable, it prints a message saying so.
The program is a proof-of-concept exploit that demonstrates how the vulnerability can be abused. It can be used for educational or testing purposes only. It should not be used for malicious or illegal activities. To use the program, the needs to have the following:
```
A Python interpreter and the requests and json modules installed.
A valid FMC web services interface URL, username, and password.
A valid domain id and device id for the FMC and FTD devices.
A list of commands that they want to execute on the FTD device.
```

## Install required libraries:
```
pip install requests
pip install json
```
## How to Use
```
import exploit
```
Call the CVE_2023_20048 function from the imported file. You can use the file name, period, and function name. For example, you can use the following code:
```
exploit.CVE-2023-20048(fmc_url, fmc_user, fmc_pass)
```
Pass the required parameters for the CVE-2023-20048 function. These parameters should be a URL, username, and password for the FMC web services interface. For example, you can use the following values:
```
fmc_url = "https://fmc.example.com"
fmc_user = "admin"
fmc_pass = "cisco123"
```
Run the file that contains the CVE-2023-20048 function. 
Monitor the results on the screen. You should see messages telling you whether FMC-managed devices are vulnerable to the CVE-2023-20048 vulnerability, and the results of command execution on vulnerable devices.

## Note: I am not responsible for the wrong or illegal use.
